---
# 非敏感的 VPS 组变量，聚合所有角色所需的共享默认值。
docker_edition: "ce"
docker_packages:
  - "docker-{{ docker_edition }}"
  - "docker-{{ docker_edition }}-cli"
  - containerd.io
  - docker-buildx-plugin
docker_packages_state: present
docker_install_compose_plugin: true
docker_compose_package: docker-compose-plugin
docker_compose_package_state: present
docker_users:
  - kchou
docker_daemon_options:
  storage-driver: overlay2
  log-opts:
    max-size: "100m"
firewall_allowed_tcp_ports:
  - "{{ security_ssh_port | default(22) }}"
firewall_state: started
firewall_enabled_at_boot: true
security_ssh_password_authentication: "no"
security_ssh_permit_root_login: "no"
security_autoupdate_enabled: true
security_ssh_allowed_users:
  - "{{ ansible_user }}"
# Fail2ban is enabled everywhere; override custom template if needed per-host.
security_fail2ban_enabled: true
security_fail2ban_custom_configuration_template: "jail.local.j2"
# Keep unattended-upgrades to security fixes only and avoid surprise reboots.
security_autoupdate_blacklist: []
security_autoupdate_additional_origins: []
security_autoupdate_reboot: "false"
security_autoupdate_reboot_time: "03:00"
security_autoupdate_mail_to: ""
security_autoupdate_mail_on_error: true

# Docker shared network defaults (all containers join this network)
docker_shared_network_name: proxy_net
docker_shared_network_subnet: "10.203.57.0/24"
docker_shared_network_gateway: "10.203.57.1"
docker_shared_network_ipam_config:
  - subnet: "{{ docker_shared_network_subnet }}"
    gateway: "{{ docker_shared_network_gateway }}"

# Cloudflared defaults
cloudflared_data_directory: /opt/cloudflared
cloudflared_image_tag: "2025.11.1"
cloudflared_tunnel_domain_name: "devopsthink.org" # TODO: 替换为 Cloudflare Access 域名
cloudflared_verify_whoami: false
cloudflared_whoami_enabled: true
cloudflared_whoami_container_name: cloudflared-whoami
cloudflared_whoami_service_host: "{{ cloudflared_whoami_container_name }}"
cloudflared_whoami_service_port: 80
cloudflared_ingress_rules:
  - hostname: "whoami.{{ cloudflared_tunnel_domain_name }}"
    service: "http://{{ cloudflared_whoami_service_host }}:{{ cloudflared_whoami_service_port }}"
  - hostname: "devopsthink.org"
    service: "http_status:404"
