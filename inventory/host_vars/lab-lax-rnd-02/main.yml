---
# lab-lax-rnd-02 部署 Traefik 代理入口
traefik_enable: true
traefik_image_tag: v3.6.2
traefik_data_directory: /opt/traefik
traefik_data_owner: "{{ ansible_user }}"
traefik_data_group: "{{ ansible_user }}"
traefik_dashboard_domain: "traefik.{{ domain_name }}"
traefik_whoami_domain: "whoami.{{ domain_name }}"
traefik_acme_email: "{{ ansible_user }}@{{ domain_name }}"
traefik_whoami_enabled: true
traefik_compression_enabled: true
traefik_file_provider_enabled: true
traefik_file_provider_config:
  http:
    middlewares:
      http-compression:
        compress: {}
    routers:
      gemi2api:
        rule: 'Host("gemi2api.{{ domain_name }}")'
        entryPoints:
          - websecure
        tls:
          certResolver: "{{ traefik_acme_resolver_name }}"
        service: gemi2api
        middlewares:
          - http-compression
      new-api:
        rule: 'Host("api.{{ domain_name }}")'
        entryPoints:
          - websecure
        tls:
          certResolver: "{{ traefik_acme_resolver_name }}"
        service: new-api
        middlewares:
          - http-compression
    services:
      gemi2api:
        loadBalancer:
          servers:
            - url: "http://{{ hostvars['lab-sfo-txy-01'].tailscale_ip }}:8000"
      new-api:
        loadBalancer:
          servers:
            - url: "http://{{ hostvars['lab-lax-rnd-01'].tailscale_ip }}:3000"
traefik_env_overrides:
  # Cloudflare DNS challenge now uses scoped API Tokens.
  CF_DNS_API_TOKEN: "{{ traefik_cloudflare_api_key | default('', true) }}"

# LobeChat 配置
lobe_chat_enable: true
lobe_chat_image_tag: v1.143.2
lobe_chat_app_url: "https://chat.{{ domain_name }}"
lobe_chat_domain: "chat.{{ domain_name }}"
lobe_chat_postgres_db: lobe
lobe_chat_postgres_user: lobe
lobe_chat_s3_bucket: chat
lobe_chat_search_providers: "searxng"
lobe_chat_searxng_url: "http://searxng:8080"

# ========== SearXNG 配置 ==========
searxng_enable: true
searxng_image_tag: 2025.12.1-ab8224c93
searxng_traefik_enabled: false # 仅供内部 LobeChat 联网搜索使用，不对外暴露
searxng_instance_name: "DevOpsThink Search"
searxng_contact_url: "mailto:admin@{{ domain_name }}"

# ========== Beszel Agent 配置 ==========
beszel_agent_enable: true
beszel_agent_env_overrides:
  KEY: "{{ beszel_agent_key | default('', true) }}"
  TOKEN: "{{ beszel_agent_token | default('', true) }}"
